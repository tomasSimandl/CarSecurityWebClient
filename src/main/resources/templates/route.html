<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:insert="fragments/general.html :: head(title='Route')"> </head>


</head>


<script  th:inline="javascript">
    function GetMap() {
        /*<![CDATA[*/
        var positions = [[${positions}]];

        var map = new Microsoft.Maps.Map(document.getElementById('myMap'), {
            /* No need to set credentials if already passed in URL */
            center: new Microsoft.Maps.Location(positions[0].latitude, positions[0].longitude),
            zoom: 16,
            mapTypeId: Microsoft.Maps.MapTypeId.road
        });
        var array = [];
        var i;
        for (i = 0; i < positions.length; i++) {
            array.push(new Microsoft.Maps.Location(positions[i].latitude, positions[i].longitude));
        }


        var polyline = new Microsoft.Maps.Polyline(positions, {strokeColor: 'Blue', strokeThickness: 2});
        map.entities.push(polyline);


        var pinStart = new Microsoft.Maps.Pushpin(array[0], {
            title: 'Start',
            color: 'green',
            text: 'S'
        });
        var pinEnd = new Microsoft.Maps.Pushpin(array[array.length-1], {
            title: 'End',
            color: 'red',
            text: 'E'
        });
        map.entities.push(pinStart);
        map.entities.push(pinEnd);



        Microsoft.Maps.loadModule('Microsoft.Maps.WellKnownText', function () {
            document.getElementById('printoutPanel').innerHTML = Microsoft.Maps.WellKnownText.write(polyline);
        });
        /*]]>*/
    }

</script>
<body>

    <nav th:insert="fragments/general.html :: navigation"></nav>

    <div class="container">

        <div onload="GetMap()" id='myMap' class="w-100" style='height: 80vh;'></div>

        <table class="table">
            <tbody>
            <tr>
                <th scope="col">car</th>
                <td th:text="${route.carName}" align="center"></td>
            </tr>
            <tr>
                <th scope="col">Date</th>
                <td th:text="${#dates.format(route.timeEpochSeconds*1000, 'dd.MM.yyyy')}"  align="center"></td>
            </tr>
            <tr>
                <th scope="col">Time</th>
                <td th:text="${#dates.format(route.timeEpochSeconds*1000, 'HH:mm:ss')}"  align="center"></td>
            </tr>
            <tr>
                <th scope="col">Length</th>
                <td th:text="|${route.length} m|" align="center"></td>
            </tr>
            <tr>
                <th scope="col">Average speed</th>
                <td th:text="|${#numbers.formatDecimal(route.avgSpeed*3.6, 0, 1)} km/h|" align="center"></td>
            </tr>
            <tr>
                <th scope="col">Travel time</th>
                <td th:with="hours=${#numbers.formatInteger(route.secondsOfTravel/3600,0)},
                                    minutes=${#numbers.formatInteger((route.secondsOfTravel/60)%60,0)},
                                    seconds=${route.secondsOfTravel%60}"
                    th:text="|${hours}:${minutes}:${seconds}|"  align="center"></td>
            </tr>
            <tr>
                <th scope="col">Note</th>
                <td th:text="${route.note}" align="center"></td>
            </tr>
            </tbody>
        </table>
    </div>


    <!-- Reference to the Bing Maps SDK -->
    <script type='text/javascript'
            th:src="@{https://www.bing.com/api/maps/mapcontrol?callback=GetMap&key={key}(key=${bingKey})}"
            async defer></script>

</body>

</html>